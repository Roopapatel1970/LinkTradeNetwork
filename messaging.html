<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Messaging ‚Äì LinkTradeNetwork</title>
<style>
  :root{
    --bg:#f3f4f6; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb; --card:#ffffff;
    --brand:#0a66c2; --brand2:#004182;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);
       font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Inter,Roboto,Arial;height:100vh;display:flex;flex-direction:column}
  a{color:inherit;text-decoration:none}

  /* Header */
  header{background:#64748b;color:#fff;box-shadow:0 2px 10px rgba(0,0,0,.12)}
  .bar{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
  .brand{display:flex;gap:10px;align-items:center;text-decoration:none;color:#fff}
  .brand b{font-size:18px}
  .nav a{color:#fff;margin-left:12px;text-decoration:none;opacity:.95}
  .nav a:hover{opacity:.85}

  /* Layout */
  main{flex:1;display:grid;grid-template-columns:280px 1fr;gap:0;height:calc(100vh - 60px)}
  .contacts{background:#fff;border-right:1px solid var(--line);overflow-y:auto}
  .contacts h2{font-size:16px;margin:12px 16px}
  .contact{display:flex;align-items:center;gap:10px;padding:10px 16px;cursor:pointer;border-bottom:1px solid #f1f5f9}
  .contact:hover{background:#f3f4f6}
  .contact.active{background:#e0e7ff}
  .ava{width:42px;height:42px;border-radius:50%;background:#eef2ff;display:flex;align-items:center;justify-content:center;overflow:hidden;flex-shrink:0}
  .ava img{width:100%;height:100%;object-fit:cover}
  .cname{font-weight:700}
  .cmuted{font-size:12px;color:#64748b}

  /* Chat */
  .chat{display:flex;flex-direction:column;height:100%}
  .chat-header{padding:12px 16px;background:#fff;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:10px}
  .chat-body{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:10px;background:#f9fafb}
  .msg{max-width:70%;padding:10px 14px;border-radius:16px;font-size:14px;line-height:1.4}
  .me{align-self:flex-end;background:#dbeafe}
  .them{align-self:flex-start;background:#fff;border:1px solid #e5e7eb}
  .chat-input{display:flex;padding:10px 16px;background:#fff;border-top:1px solid var(--line);gap:10px}
  #messageInput{flex:1;border:1px solid #d1d5db;border-radius:20px;padding:.6rem .9rem}
  #sendBtn{background:var(--brand);color:#fff;border:none;border-radius:20px;padding:.6rem 1rem;font-weight:700;cursor:pointer}
  #sendBtn:hover{background:var(--brand2)}
  @media(max-width:800px){main{grid-template-columns:1fr}}
</style>
</head>
<body>

<header>
  <div class="bar">
    <a class="brand" href="front.html"><span style="font-size:22px">üåç</span><b>LinkTradeNetwork</b></a>
    <div class="nav">
      <a href="front.html">Home</a>
      <a href="network.html">Network</a>
      <a href="messaging.html">Messaging</a>
      <a href="my-profile.html">My Profile</a>
    </div>
  </div>
</header>

<main>
  <aside class="contacts" id="contactList">
    <h2>Messages</h2>
  </aside>

  <section class="chat">
    <div class="chat-header" id="chatHeader">Select a contact</div>
    <div class="chat-body" id="chatBody"></div>
    <div class="chat-input">
      <input id="messageInput" placeholder="Type a message..." disabled>
      <button id="sendBtn" disabled>Send</button>
    </div>
  </section>
</main>

<script>
const PKEY='ltnPeople', CKEY='ltnConnections', MKEY='ltnMessages';
const $=id=>document.getElementById(id);
function load(k,d){try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}}
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}

/* Load contacts */
let people=load(PKEY,[]);
let connections=new Set(load(CKEY,[]));
let messages=load(MKEY,{});
let active=null;

function nameOf(p){return`${p.firstName||''} ${p.lastName||''}`.trim()||'Unknown'}
function renderContacts(){
  const c=$('contactList');
  const con=people.filter(p=>connections.has(p.id));
  c.innerHTML='<h2>Messages</h2>'+(
    con.length?con.map(p=>`<div class="contact" data-id="${p.id}">
      <div class="ava">üë§</div>
      <div><div class="cname">${nameOf(p)}</div>
      <div class="cmuted">${p.trade||''}</div></div></div>`).join('')
    :'<div style="padding:12px;color:#6b7280">No connections yet.</div>');
  c.querySelectorAll('.contact').forEach(el=>el.onclick=()=>openChat(el.dataset.id));
}
renderContacts();

/* Open chat */
function openChat(id){
  active=id;
  document.querySelectorAll('.contact').forEach(el=>el.classList.toggle('active',el.dataset.id===id));
  const p=people.find(x=>x.id===id);
  $('chatHeader').textContent=nameOf(p);
  $('messageInput').disabled=false;
  $('sendBtn').disabled=false;
  renderChat();
}

/* Render messages */
function renderChat(){
  const body=$('chatBody');
  body.innerHTML='';
  const thread=messages[active]||[];
  thread.forEach(m=>{
    const div=document.createElement('div');
    div.className='msg '+(m.me?'me':'them');
    div.textContent=m.text;
    body.appendChild(div);
  });
  body.scrollTop=body.scrollHeight;
}

/* Send message */
$('sendBtn').onclick=sendMsg;
$('messageInput').addEventListener('keydown',e=>{if(e.key==='Enter')sendMsg();});

function sendMsg(){
  const t=$('messageInput').value.trim();
  if(!t||!active)return;
  messages[active]=messages[active]||[];
  messages[active].push({me:true,text:t});
  save(MKEY,messages);
  $('messageInput').value='';
  renderChat();

  // Simulated auto reply
  setTimeout(()=>{
    messages[active].push({me:false,text:'Thanks for your message!'});
    save(MKEY,messages);
    renderChat();
  },800);
}

/* Handle ?to= parameter (auto-open from network.html) */
(function(){
  const sp=new URLSearchParams(location.search);
  const id=sp.get('to');
  if(id){
    setTimeout(()=>{openChat(id);},400);
    history.replaceState({},'', 'messaging.html');
  }
})();
</script>
</body>
</html>


