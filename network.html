<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Network ‚Äì LinkTradeNetwork</title>
<style>
  :root{
    --bg:#f3f4f6; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb; --card:#ffffff;
    --brand:#0a66c2; --brand2:#004182;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);
       font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Inter,Roboto,Arial}
  a{color:inherit;text-decoration:none}

  /* Header */
  header{background:#64748b;color:#fff;box-shadow:0 2px 10px rgba(0,0,0,.12)}
  .bar{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
  .brand{display:flex;gap:10px;align-items:center;text-decoration:none;color:#fff}
  .brand b{font-size:18px}
  .nav a{color:#fff;margin-left:12px;text-decoration:none;opacity:.95}
  .nav a:hover{opacity:.85}

  /* Layout */
  .wrap{max-width:1100px;margin:20px auto;padding:0 14px;display:grid;grid-template-columns:280px 1fr;gap:18px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.05)}
  .pad{padding:14px}

  /* Sidebar */
  .side h3{margin:0 0 10px}
  .filter .row{display:grid;gap:6px;margin-bottom:10px}
  .filter input{border:1px solid #d1d5db;border-radius:10px;padding:.55rem .7rem}

  .you{display:flex;gap:10px;align-items:center;border:1px solid #e5e7eb;border-radius:10px;padding:10px;margin-bottom:14px;background:#fff}
  .ava{width:48px;height:48px;border-radius:50%;background:#eef2ff;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .ava img{width:100%;height:100%;object-fit:cover}
  .muted{color:var(--muted);font-size:13px}

  /* Requests panel */
  .req-item{display:grid;grid-template-columns:40px 1fr auto;gap:10px;align-items:center;padding:8px 0;border-top:1px solid #f1f5f9}
  .req-item:first-child{border-top:none}
  .mini-ava{width:40px;height:40px;border-radius:50%;background:#eef2ff;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .req-name{font-weight:800}
  .req-meta{font-size:12px;color:#64748b}
  .req-actions{display:flex;gap:6px}
  .badge{display:inline-block;background:#fee2e2;color:#991b1b;border:1px solid #fecaca;border-radius:999px;font-size:12px;padding:.1rem .5rem;margin-left:6px}

  /* Directory */
  .tools{display:flex;gap:10px;align-items:center;margin-bottom:10px}
  .tools input{border:1px solid #d1d5db;border-radius:999px;padding:.6rem .9rem}
  #search{width:240px}
  #globalSearch{flex:1}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
  .person{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff;display:grid;grid-template-columns:56px 1fr auto;gap:12px;align-items:center}
  .name{font-weight:800}
  .meta{color:#475569;font-size:13px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .btn{background:var(--brand);color:#fff;border:none;border-radius:10px;padding:.45rem .8rem;font-weight:700;cursor:pointer}
  .btn:hover{background:var(--brand2)}
  .btn.ghost{background:#fff;color:#0f172a;border:1px solid #e5e7eb}
  .btn.ghost:hover{background:#f8fafc}
  .btn.gray{background:#6b7280}.btn.gray:hover{background:#4b5563}
  .empty{padding:16px;color:#6b7280;text-align:center}
  @media(max-width:900px){ .wrap{grid-template-columns:1fr} }
</style>
</head>
<body>

<header>
  <div class="bar">
    <a class="brand" href="front.html"><span style="font-size:22px">üåç</span><b>LinkTradeNetwork</b></a>
    <div class="nav">
      <a href="front.html">Home</a>
      <a href="network.html">Network</a>
      <a href="messaging.html">Messaging</a>
      <a href="my-profile.html">My Profile</a>
    </div>
  </div>
</header>

<main class="wrap">
  <!-- Sidebar -->
  <aside class="card pad side">
    <div class="you">
      <div class="ava" id="youAva">üë§</div>
      <div>
        <div id="youName" style="font-weight:800">You</div>
        <div class="muted" id="youHeadline"></div>
      </div>
    </div>

    <h3>Filters</h3>
    <div class="filter">
      <div class="row"><input id="q" placeholder="Search name or trade"></div>
      <div class="row"><input id="fTrade" placeholder="Trade"></div>
      <div class="row"><input id="fLoc" placeholder="Location"></div>
    </div>

    <h3 style="margin-top:12px">Add person (local)</h3>
    <div class="filter">
      <div class="row"><input id="addName" placeholder="Full name"></div>
      <div class="row"><input id="addTrade" placeholder="Trade"></div>
      <div class="row"><input id="addLoc" placeholder="Location"></div>
      <div class="row"><input id="addEmail" placeholder="Email (optional)"></div>
      <div class="row"><button class="btn gray" id="addBtn" type="button">Add</button></div>
      <div class="muted">Adds to your local directory only.</div>
    </div>
  </aside>

  <!-- Main column -->
  <section>
    <!-- Incoming Requests Panel -->
    <div class="card pad" id="requestsCard" style="display:none">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
        <h3 style="margin:0">Incoming Requests <span id="reqCount" class="badge" style="display:none"></span></h3>
        <button class="btn ghost" id="acceptAllBtn" type="button">Accept All</button>
      </div>
      <div id="requestsList"></div>
      <div class="muted" style="margin-top:8px">These requests were sent to you (e.g., via invite links).</div>
    </div>

    <!-- Directory -->
    <div class="card pad">
      <div class="tools">
        <input id="search" placeholder="Filter visible people">
        <input id="globalSearch" placeholder="Search or add by name/email‚Ä¶ (Enter)">
        <button class="btn ghost" id="showAll" type="button">Show all</button>
      </div>
      <div id="dir" class="grid"></div>
      <div class="muted" style="margin-top:10px">
        Tip: Share an <b>Invite Link</b> to connect someone new.
      </div>
    </div>
  </section>
</main>

<script>
/* Shared keys */
const PKEY='ltnPeople', CKEY='ltnConnections', RKEY='ltnRequests', MEKEY='userProfile:v1';
const $=id=>document.getElementById(id);
function load(k,d){try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}}
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}

/* Seed demo users if empty */
(function seed(){
  if(!load(PKEY,[]).length){
    save(PKEY,[
      {id:'p-rosa',firstName:'Rosa',lastName:'Vega',trade:'Tower/Fiber Tech',location:'Milwaukee, WI'},
      {id:'p-tim',firstName:'Tim',lastName:'McCarron',trade:'Cabling',location:'Madison, WI'},
      {id:'p-lee',firstName:'Lee',lastName:'Khan',trade:'Access Control',location:'Chicago, IL'},
      {id:'p-sam',firstName:'Sam',lastName:'Park',trade:'Low Voltage',location:'Detroit, MI'}
    ]);
  }
  if(!Array.isArray(load(CKEY,null))) save(CKEY,[]);
  if(!Array.isArray(load(RKEY,null))) save(RKEY,[]);
})();

/* Me card */
let me=load(MEKEY,null);
(function(){
  const ava=$('youAva'), nm=$('youName'), hd=$('youHeadline');
  if(me?.photo) ava.innerHTML=`<img src="${me.photo}" alt="">`;
  nm.textContent = me ? `${me.firstName||''} ${me.lastName||''}`.trim() || 'You' : 'You';
  hd.textContent = me?.headline || '';
})();

/* State */
let people=load(PKEY,[]);
let connections=new Set(load(CKEY,[]));
let requests=new Set(load(RKEY,[]));

/* Helpers */
function nameOf(p){return `${p.firstName||''} ${p.lastName||''}`.trim()||'Unknown'}
function avatarHtml(p){ return p?.photo ? `<img src="${p.photo}" alt="">` : 'üë§' }

/* ----- Requests panel render ----- */
function renderRequests(){
  people=load(PKEY,[]);
  requests=new Set(load(RKEY,[]));

  const ids=[...requests];
  const card=$('requestsCard');
  const countEl=$('reqCount');
  const listEl=$('requestsList');

  if(!ids.length){
    card.style.display='none';
    listEl.innerHTML='';
    return;
  }

  card.style.display='block';
  countEl.style.display='inline-block';
  countEl.textContent=ids.length;

  listEl.innerHTML=ids.map(id=>{
    const p=people.find(x=>x.id===id) || {firstName:'Unknown', lastName:'', trade:'', location:''};
    return `
      <div class="req-item">
        <div class="mini-ava">${avatarHtml(p)}</div>
        <div>
          <div class="req-name">${nameOf(p)}</div>
          <div class="req-meta">${[p.trade,p.location].filter(Boolean).join(' ‚Ä¢ ')}</div>
        </div>
        <div class="req-actions">
          <button class="btn" onclick="accept('${id}')">Accept</button>
          <button class="btn ghost" onclick="decline('${id}')">Decline</button>
        </div>
      </div>`;
  }).join('');
}

/* ----- Directory render ----- */
function personCard(p){
  const id=p.id;
  const isConn=connections.has(id);
  const isReq=requests.has(id);
  const btns = isConn
    ? `<button class="btn" onclick="message('${id}')">Message</button>
       <button class="btn ghost" onclick="removeConn('${id}')">Remove</button>`
    : isReq
      ? `<button class="btn" onclick="accept('${id}')">Accept</button>
         <button class="btn ghost" onclick="decline('${id}')">Decline</button>`
      : `<button class="btn" onclick="connect('${id}')">Connect</button>
         <button class="btn ghost" onclick="copyInvite('${id}')">Invite Link</button>`;

  return `
    <div class="person">
      <div class="ava">${avatarHtml(p)}</div>
      <div>
        <div class="name">${nameOf(p)}</div>
        <div class="meta">${[p.trade,p.location].filter(Boolean).join(' ‚Ä¢ ')}</div>
      </div>
      <div class="row">${btns}</div>
    </div>`;
}
function renderDirectory(){
  people=load(PKEY,[]);
  connections=new Set(load(CKEY,[]));
  requests=new Set(load(RKEY,[]));

  const q=($('q').value||$('search').value||'').toLowerCase();
  const t=($('fTrade').value||'').toLowerCase();
  const l=($('fLoc').value||'').toLowerCase();

  const list=people.filter(p=>{
    const hay=(nameOf(p)+' '+(p.trade||'')+' '+(p.location||'')).toLowerCase();
    return(!q||hay.includes(q))&&(!t||(p.trade||'').toLowerCase().includes(t))&&(!l||(p.location||'').toLowerCase().includes(l));
  });

  $('dir').innerHTML=list.length?list.map(personCard).join(''):`<div class="empty">No matches.</div>`;
}

/* Combined render */
function renderAll(){
  renderRequests();
  renderDirectory();
}
renderAll();

/* ----- Actions ----- */
window.connect = id => {
  // Local demo: add as pending request (for your own device)
  requests.add(id); save(RKEY,[...requests]); renderAll();
  alert('Request sent (demo). To invite someone on another device, use Invite Link.');
};
window.accept = id => {
  requests.delete(id); connections.add(id);
  save(RKEY,[...requests]); save(CKEY,[...connections]); renderAll();
};
window.decline = id => {
  requests.delete(id); save(RKEY,[...requests]); renderAll();
};
window.removeConn = id => {
  if(confirm('Remove this connection?')){
    connections.delete(id); save(CKEY,[...connections]); renderAll();
  }
};
window.message = id => { location.href = `messaging.html?to=${encodeURIComponent(id)}`; };

/* Accept All in panel */
$('acceptAllBtn').onclick = ()=>{
  const ids=[...new Set(load(RKEY,[]))];
  if(!ids.length) return;
  ids.forEach(id=>connections.add(id));
  save(CKEY,[...connections]); save(RKEY,[]);
  renderAll();
};

/* ----- Filters & search ----- */
['q','fTrade','fLoc','search'].forEach(id=>$(`${id}`).addEventListener('input',renderAll));
$('showAll').onclick = ()=>{
  ['q','fTrade','fLoc','search'].forEach(id=>$(`${id}`).value='');
  renderAll();
};

/* ----- Add person (local) ----- */
$('addBtn').onclick=()=>{
  const n=$('addName').value.trim(); if(!n) return alert('Enter a name');
  const [f,...r]=n.split(' ');
  const p={id:'p-'+Date.now(),firstName:f,lastName:r.join(' '),
    trade:$('addTrade').value.trim(),location:$('addLoc').value.trim(),email:$('addEmail').value.trim(),photo:''};
  const arr=load(PKEY,[]); arr.unshift(p); save(PKEY,arr);
  ['addName','addTrade','addLoc','addEmail'].forEach(i=>$(`${i}`).value='');
  renderAll();
};

/* ----- Invite Links (Option A) ----- */
function myProfile() {
  const me = load(MEKEY, null);
  const name = me ? `${me.firstName||''} ${me.lastName||''}`.trim() : '';
  const baseId = (me?.email || name || 'user').toLowerCase().replace(/\s+/g,'-');
  return {
    id: baseId,
    firstName: me?.firstName || '',
    lastName:  me?.lastName  || '',
    email:     me?.email     || '',
    trade:     me?.trade     || '',
    location:  me?.location  || '',
    photo:     me?.photo     || ''
  };
}
window.copyInvite = targetId => {
  const inviter=myProfile();
  if(!inviter.email && !inviter.firstName && !inviter.lastName){
    alert('Add your name or email in Build Profile first.'); return;
  }
  const payload={v:1,inviter,to:targetId,ts:Date.now()};
  const enc=btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
  const base=new URL(window.location.href); base.search=''; base.hash=''; base.pathname='accept-invite.html';
  const link=`${base}?invite=${encodeURIComponent(enc)}`;
  navigator.clipboard?.writeText(link).then(()=>alert('Invite link copied!'),()=>prompt('Copy this link:',link));
};

/* Handle incoming invite links (?invite=)  ‚Äî keep support if someone lands here */
(function handleIncomingInvite(){
  const sp=new URLSearchParams(location.search);
  const raw=sp.get('invite'); if(!raw) return;
  try{
    const p=JSON.parse(decodeURIComponent(escape(atob(raw))));
    if(p?.v!==1) return;
    const arr=load(PKEY,[]);
    if(!arr.find(x=>x.id===p.inviter.id)) arr.unshift(p.inviter);
    save(PKEY,arr);
    const req=new Set(load(RKEY,[])); req.add(p.inviter.id); save(RKEY,[...req]);
    if(history.replaceState){ history.replaceState({},'', 'network.html'); }
    renderAll();
    alert(`Connection request from ${p.inviter.firstName||'Someone'}.`);
  }catch(e){ console.warn(e); }
})();

/* Global name/email add-or-find */
const g=$('globalSearch');
function norm(s){return (s||'').toLowerCase().trim();}
function findByEmail(email){const e=norm(email); if(!e) return null; return people.find(p=>norm(p.email)===e)||null;}
function findByName(name){const n=norm(name); if(!n) return null; return people.find(p=>norm(`${p.firstName||''} ${p.lastName||''}`)===n)||null;}
function ensurePersonByNameEmail(name,email){
  let found=email?findByEmail(email):null; if(found) return found;
  found=name?findByName(name):null; if(found) return found;
  const id='p-'+Date.now();
  let firstName='',lastName=''; if(name){const parts=name.trim().split(/\s+/); firstName=parts.shift()||''; lastName=parts.join(' ');}
  const person={id,firstName,lastName,trade:'',location:'',email:(email||'').trim(),photo:''};
  const arr=load(PKEY,[]); arr.unshift(person); save(PKEY,arr); people=arr; renderAll(); return person;
}
function scrollToPerson(id){
  const card = Array.from(document.querySelectorAll('.person'))
    .find(el => el.querySelector(`.row button[onclick*="'${id}'"]`));
  if(card){ card.style.outline='2px solid #60a5fa'; card.scrollIntoView({behavior:'smooth',block:'center'});
    setTimeout(()=>card.style.outline='',1200); }
}
g.addEventListener('keydown', (e)=>{
  if(e.key!=='Enter') return;
  const val=g.value.trim(); if(!val) return;
  let name='',email='';
  if(val.includes('@') && val.includes('.')){ email=val; name=(prompt('Enter their full name (optional):','')||'').trim(); }
  else { name=val; email=(prompt('Enter their email (optional):','')||'').trim(); }
  const person=ensurePersonByNameEmail(name,email);
  if(confirm(`Found/added "${(person.firstName||'')+' '+(person.lastName||'')}". Copy an invite link to send them?`)){
    copyInvite(person.id);
  }
  scrollToPerson(person.id);
  g.value='';
});

/* Handle ?query= from front.html */
(function(){
  const sp=new URLSearchParams(location.search);
  const q=sp.get('query'); if(!q) return;
  g.value=q;
  g.dispatchEvent(new KeyboardEvent('keydown',{key:'Enter',bubbles:true}));
  if(history.replaceState){ history.replaceState({},'', 'network.html'); }
})();
</script>
</body>
</html>




