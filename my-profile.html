<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>My Profile ‚Äì LinkTradeNetwork</title>
<style>
  :root{--ink:#1f2937;--muted:#6b7280;--line:#e5e7eb;--bg:#f3f4f6;--card:#fff;--brand:#0a66c2;--brand2:#004182;--chip:#eef2ff}
  *{box-sizing:border-box}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Inter,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  a{color:inherit;text-decoration:none}

  header{background:#64748b;padding:1rem 2rem;box-shadow:0 2px 10px rgba(0,0,0,.1)}
  .topbar{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:12px;justify-content:space-between}
  .brand{display:flex;align-items:center;gap:12px;color:#fff}
  .brand .logo-icon{font-size:2rem}
  .brand .brand-text{font-weight:800}
  .actions{display:flex;gap:8px;align-items:center}
  .btn{background:var(--brand);color:#fff;border:none;border-radius:8px;padding:.55rem .85rem;font-weight:800;cursor:pointer}
  .btn:hover{background:var(--brand2)}
  .btn.gray{background:#6b7280}.btn.gray:hover{background:#4b5563}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.7);color:#fff}
  .status{font-size:.95rem;color:#047857;background:#d1fae5;border:1px solid #10b981;padding:.35rem .6rem;border-radius:8px;display:none}
  .status.show{display:inline-block}

  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
  .profile-card{padding:16px}
  .profile-row{display:flex;gap:16px;align-items:flex-start}
  .avatar{position:relative;width:128px;height:128px;border-radius:50%;border:4px solid #fff;background:#eef2ff;display:flex;align-items:center;justify-content:center;font-size:56px;color:#9aa2b1;overflow:hidden;flex-shrink:0;box-shadow:0 0 0 1px var(--line)}
  .avatar img{width:100%;height:100%;object-fit:cover}
  .avatar .edit-badge{display:none;position:absolute;bottom:8px;right:8px;background:#000a;color:#fff;padding:.25rem .45rem;border-radius:8px;font-size:12px}
  .edit-mode .avatar .edit-badge{display:block;cursor:pointer}

  .flex-1{flex:1;min-width:0}
  .headline{font-size:26px;font-weight:800;margin:2px 0}
  .sub{color:var(--muted)}
  .meta{display:flex;gap:14px;flex-wrap:wrap;color:#4b5563;margin-top:8px}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .chip{background:#fff7e0;border:1px solid #fde68a;color:#92400e;padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px}
  .chip.select{padding:0}
  .chip select{appearance:none;background:transparent;border:none;padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px;outline:none;color:#92400e}

  .toolbar{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
  .grid{display:grid;grid-template-columns:minmax(0,2fr) minmax(280px,1fr);gap:16px;margin-top:16px}
  .section{padding:16px}
  .section h2{font-size:18px;margin:0 0 8px}
  .about[contenteditable="true"], .editable[contenteditable="true"]{outline:2px solid #e0ecff;border-radius:8px;padding:6px}
  .about{white-space:pre-wrap;line-height:1.7;color:#374151;min-height:1.5em}

  .exp-item{padding:12px 0;border-bottom:1px solid var(--line)}
  .exp-item:last-child{border-bottom:none}
  .exp-title{font-weight:800}
  .exp-meta{color:#6b7280;font-size:14px;margin:4px 0}
  .exp-desc{white-space:pre-wrap;color:#374151;margin-top:6px}
  .exp-tools{display:none;gap:6px;margin-top:6px}
  .edit-mode .exp-tools{display:flex}
  .icon-btn{background:#f3f4f6;border:1px solid #e5e7eb;border-radius:6px;padding:4px 8px;cursor:pointer;font-size:12px}
  .icon-btn.danger{background:#fff5f5;border-color:#fecaca;color:#b91c1c}

  .skills{display:flex;flex-wrap:wrap;gap:8px}
  .skill{background:var(--chip);border:1px solid #dfe3f6;padding:6px 12px;border-radius:999px;font-weight:700;color:#27316f}
  .skill.edit{cursor:pointer}
  .add-skill{display:none;margin-top:10px;gap:6px}
  .add-skill input{flex:1;border:1px solid #d1d5db;border-radius:8px;padding:.5rem .6rem}
  .edit-mode .add-skill{display:flex}

  .side .row{display:flex;align-items:center;gap:8px;margin:8px 0;color:#374151}
  .side .pill{display:inline-block;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:999px;padding:4px 10px;font-weight:700;font-size:12px;color:#374151}

  footer{color:#64748b;font-size:13px;text-align:center;padding:24px}
  @media (max-width:900px){ .grid{grid-template-columns:1fr} .profile-row{flex-direction:column;align-items:start} }
  @media print{ header,.toolbar,.actions{display:none!important} body{background:#fff} .about[contenteditable], .editable[contenteditable]{outline:none} }
</style>
</head>
<body>
<header>
  <div class="topbar">
    <a class="brand" href="front.html" title="Home">
      <span class="logo-icon">üåç</span>
      <span class="brand-text">LinkTradeNetwork</span>
    </a>
    <div class="actions">
      <a class="btn ghost" href="front.html">Home</a>
      <span id="saveStatus" class="status">Saved ‚úì</span>
      <button class="btn gray" id="exportBtn" type="button">Export PDF</button>
      <button class="btn" id="saveBtn" type="button" title="Save locally">Save</button>
      <button class="btn edit-toggle" id="editToggle" type="button">Edit</button>
    </div>
  </div>
</header>

<main class="wrap" id="mainWrap">
  <!-- profile header -->
  <section class="card profile-card">
    <div class="profile-row">
      <div class="avatar" id="avatar">
        <span>üë§</span>
        <span class="edit-badge" id="avatarEdit">Edit photo</span>
        <input id="photoInput" type="file" accept="image/*" style="display:none">
      </div>
      <div class="flex-1">
        <div class="headline">
          <span id="name" class="editable" data-field="name" contenteditable="false">Your Name</span>
        </div>
        <div class="sub">
          <span id="headline" class="editable" data-field="headline" contenteditable="false">Headline</span>
        </div>
        <div class="meta">
          <div><strong>üîß</strong> <span id="trade" class="editable" data-field="trade" contenteditable="false">‚Äî</span></div>
          <div><strong>üìç</strong> <span id="location" class="editable" data-field="location" contenteditable="false">‚Äî</span></div>
          <div><strong>üìß</strong> <span id="email" class="editable" data-field="email" contenteditable="false">‚Äî</span></div>
          <div><strong>üìû</strong> <span id="phone" class="editable" data-field="phone" contenteditable="false">‚Äî</span></div>
        </div>
        <div class="chips" id="availWrap">
          <span class="chip" id="availabilityChip">Employed</span>
          <span class="chip select" id="availabilitySelectWrap" style="display:none">
            <select id="availabilitySelect">
              <option>Employed</option>
              <option>Actively Looking</option>
              <option>Open to Offers</option>
              <option>Not Available</option>
            </select>
          </span>
        </div>

        <div class="toolbar">
          <a class="btn gray" href="build-profile.html" target="_blank" rel="noopener">Open Builder</a>
        </div>
      </div>
    </div>
  </section>

  <!-- content -->
  <section class="grid">
    <div>
      <div class="card section" id="aboutSec">
        <h2>About</h2>
        <div class="about editable" id="about" data-field="summary" contenteditable="false">No summary yet.</div>
      </div>

      <div class="card section" id="expSec" style="display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2>Experience</h2>
          <button class="btn gray" id="addExpBtn" type="button" style="display:none">Add Experience</button>
        </div>
        <div id="expList"></div>
      </div>

      <div class="card section" id="skillsSec" style="display:none">
        <h2>Skills</h2>
        <div class="skills" id="skillsList"></div>
        <div class="add-skill">
          <input id="skillInput" placeholder="Add a skill and press Enter or +"/>
          <button class="btn" id="addSkillBtn" type="button">+</button>
        </div>
      </div>

      <div class="card section" id="certsSec" style="display:none">
        <h2>Certifications & Licenses</h2>
        <div class="about editable" id="certs" data-field="certifications" contenteditable="false">‚Äî</div>
      </div>
    </div>

    <aside class="card section side">
      <h2>Contact & Status</h2>
      <div class="row"><strong>üìß</strong><a id="emailLink" href="#">‚Äî</a></div>
      <div class="row"><strong>üìû</strong><a id="phoneLink" href="#">‚Äî</a></div>
      <div class="row"><strong>üìç</strong><span id="locSide">‚Äî</span></div>
      <div class="row"><strong>üîß</strong><span id="tradeSide">‚Äî</span></div>
      <div class="row"><span class="pill" id="availSide">Employed</span></div>
    </aside>
  </section>
</main>

<footer>¬© LinkTradeNetwork ‚Äî Profile</footer>

<script>
/* ===== Config & keys ===== */
const STORAGE_KEY = 'userProfile:v1';
const LEGACY_KEY  = 'userProfile';

/* ===== State ===== */
let profile = null;
let editMode = false;
let currentPhotoDataUrl = '';

/* ===== Elements ===== */
const $ = id => document.getElementById(id);
const els = {
  saveBtn: $('saveBtn'), exportBtn: $('exportBtn'), editToggle: $('editToggle'), saveStatus: $('saveStatus'),
  avatar: $('avatar'), avatarEdit: $('avatarEdit'), photoInput: $('photoInput'),
  name: $('name'), headline: $('headline'), trade: $('trade'), location: $('location'), email: $('email'), phone: $('phone'),
  availabilityChip: $('availabilityChip'), availabilitySelectWrap: $('availabilitySelectWrap'), availabilitySelect: $('availabilitySelect'),
  about: $('about'), certs: $('certs'),
  expSec: $('expSec'), expList: $('expList'), addExpBtn: $('addExpBtn'),
  skillsSec: $('skillsSec'), skillsList: $('skillsList'), addSkillBtn: $('addSkillBtn'), skillInput: $('skillInput'),
  emailLink: $('emailLink'), phoneLink: $('phoneLink'), locSide: $('locSide'), tradeSide: $('tradeSide'), availSide: $('availSide'),
  aboutSec: $('aboutSec'), certsSec: $('certsSec')
};

/* ===== Utils ===== */
const debounce = (fn, ms=500)=>{ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; };
const escapeHTML = s => String(s ?? '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
const telHref = raw => { const d=(raw||'').replace(/\D/g,''); return d?`tel:${d}`:'#'; };
const mailHref = e => e?`mailto:${e}`:'#';
function fmtPhone(raw){ const d=(raw||'').replace(/\D/g,'').slice(-10); return d.length===10?`(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`:escapeHTML(raw||''); }
function availChip(a){ if(a==='Actively Looking') return {txt:'Actively Looking', bg:'#e6f4ea', color:'#0f5132', border:'#b7e1c1'};
  if(a==='Open to Offers') return {txt:'Open to Offers', bg:'#e7f0ff', color:'#0a66c2', border:'#c7daf8'};
  if(a==='Not Available')  return {txt:'Not Available', bg:'#fde2e2', color:'#991b1b', border:'#f8caca'};
  return {txt:'Employed', bg:'#fff7e0', color:'#92400e', border:'#fde68a'}; }

/* ===== Storage ===== */
function loadProfile(){ const raw = localStorage.getItem(STORAGE_KEY) || localStorage.getItem(LEGACY_KEY); try{return raw?JSON.parse(raw):null}catch{return null}}
function saveProfile(){ const json = JSON.stringify(profile); localStorage.setItem(STORAGE_KEY,json); localStorage.setItem(LEGACY_KEY,json); tickSaved(); }
const tickSaved = debounce(()=>{ els.saveStatus.textContent='Saved ‚úì'; els.saveStatus.classList.add('show'); setTimeout(()=>els.saveStatus.classList.remove('show'),1200); },50);

/* ===== Render ===== */
function updateAvailabilityUI(value){
  const ac = availChip(value);
  els.availabilityChip.textContent = ac.txt;
  Object.assign(els.availabilityChip.style,{background:ac.bg,color:ac.color,border:`1px solid ${ac.border}`,borderRadius:'999px'});
  els.availabilitySelect.value = value || 'Employed';
  els.availSide.textContent = ac.txt;
}
function renderExperiences(){
  els.expList.innerHTML = '';
  const exps = Array.isArray(profile.experiences) ? profile.experiences : [];
  if(!exps.length && !editMode){ els.expSec.style.display='none'; return; }
  els.expSec.style.display='block';
  exps.forEach((exp, idx)=>{
    const title = escapeHTML(exp.jobTitle||'Position');
    const company = escapeHTML(exp.company||'Company');
    const dates = [exp.startDate||'', exp.endDate||''].filter(Boolean).join(' ‚Äì ');
    const desc = escapeHTML(exp.description||'');
    const div = document.createElement('div');
    div.className='exp-item';
    div.innerHTML = `
      <div class="exp-title">${title}</div>
      <div class="exp-meta">${company}${dates ? ' ¬∑ ' + escapeHTML(dates) : ''}</div>
      ${desc ? `<div class="exp-desc">${desc}</div>`:''}
    `;
    els.expList.appendChild(div);
  });
}
function renderSkills(){
  els.skillsList.innerHTML = '';
  const skills = (profile.skills||'').split(',').map(s=>s.trim()).filter(Boolean);
  if(!skills.length && !editMode){ els.skillsSec.style.display='none'; return; }
  els.skillsSec.style.display='block';
  skills.forEach(s=>{ const span=document.createElement('span'); span.className='skill'; span.textContent=s; els.skillsList.appendChild(span); });
}

function renderAll(){
  if(!profile){
    document.getElementById('mainWrap').innerHTML =
      `<section class="card section" style="margin-top:16px;text-align:center">
         <h2>No Profile Found</h2>
         <p class="sub" style="margin:.5rem 0 1rem">Create your profile to see it here.</p>
         <a class="btn gray" href="build-profile.html">Build Profile</a>
       </section>`;
    return;
  }
  // photo
  currentPhotoDataUrl = profile.photo || '';
  els.avatar.innerHTML = currentPhotoDataUrl
    ? `<img src="${escapeHTML(currentPhotoDataUrl)}" alt="Profile photo"><span class="edit-badge" id="avatarEdit">Edit photo</span><input id="photoInput" type="file" accept="image/*" style="display:none">`
    : `<span>üë§</span><span class="edit-badge" id="avatarEdit">Edit photo</span><input id="photoInput" type="file" accept="image/*" style="display:none">`;
  els.avatarEdit = document.getElementById('avatarEdit');
  els.photoInput = document.getElementById('photoInput');
  bindPhotoControls();

  const fullName = `${profile.firstName||''} ${profile.lastName||''}`.trim();
  els.name.textContent = fullName || 'Your Name';
  els.headline.textContent = profile.headline || 'Headline';
  els.trade.textContent = profile.trade || '‚Äî';
  els.location.textContent = profile.location || '‚Äî';
  els.email.textContent = profile.email || '‚Äî';
  els.phone.textContent = profile.phone || '‚Äî';

  // availability + sidebar
  updateAvailabilityUI(profile.availability||'Employed');
  els.emailLink.href = profile.email ? mailHref(profile.email) : '#'; els.emailLink.textContent = profile.email || '‚Äî';
  els.phoneLink.href = profile.phone ? telHref(profile.phone) : '#'; els.phoneLink.textContent = profile.phone ? fmtPhone(profile.phone) : '‚Äî';
  els.locSide.textContent = profile.location || '‚Äî'; els.tradeSide.textContent = profile.trade || '‚Äî';

  // about/skills/experience/certs
  const hasAbout = !!(profile.summary && profile.summary.trim());
  els.about.textContent = hasAbout ? profile.summary : 'No summary yet.'; els.aboutSec.style.display='block';
  const hasCerts = !!(profile.certifications && profile.certifications.trim());
  els.certs.textContent = hasCerts ? profile.certifications : '‚Äî'; els.certsSec.style.display = hasCerts ? 'block' : 'none';

  renderExperiences(); renderSkills();
}

/* ===== Inline editing ===== */
function setEditable(on){
  ['name','headline','trade','location','email','phone','about','certs'].forEach(id=>{ const n=$(id); n.contentEditable = on?'true':'false'; });
  document.body.classList.toggle('edit-mode', on);
  els.availabilitySelectWrap.style.display = on ? 'inline-block' : 'none';
}
function splitName(full){
  const t = full.trim().replace(/\s+/g,' ');
  if(!t) return {firstName:'',lastName:''};
  const parts = t.split(' '); const firstName = parts.shift()||''; const lastName = parts.join(' ');
  return {firstName,lastName};
}
function onInlineChange(){
  profile.firstName = splitName(els.name.innerText).firstName;
  profile.lastName  = splitName(els.name.innerText).lastName;
  profile.headline  = els.headline.innerText.trim();
  profile.trade     = els.trade.innerText.trim();
  profile.location  = els.location.innerText.trim();
  profile.email     = els.email.innerText.trim();
  profile.phone     = els.phone.innerText.trim();
  profile.summary   = els.about.innerText.trim();
  profile.certifications = els.certs.innerText.trim();
  saveProfile(); renderAll();
}
['name','headline','trade','location','email','phone','about','certs'].forEach(id=>{
  $(id).addEventListener('input', debounce(onInlineChange, 300));
});
els.availabilitySelect.addEventListener('change', ()=>{
  profile.availability = els.availabilitySelect.value; saveProfile(); renderAll();
});

/* ===== Photo ===== */
function bindPhotoControls(){
  if(!els.avatarEdit || !els.photoInput) return;
  els.avatarEdit.onclick = ()=>els.photoInput.click();
  els.photoInput.onchange = e=>{
    const f = e.target.files?.[0]; if(!f) return;
    const r = new FileReader();
    r.onload = ()=>{ profile.photo = r.result; saveProfile(); renderAll(); };
    r.readAsDataURL(f);
  };
}

/* ===== Buttons ===== */
els.editToggle.onclick = ()=>{
  editMode = !editMode;
  els.editToggle.textContent = editMode ? 'Done' : 'Edit';
  setEditable(editMode);
};
els.exportBtn.onclick = ()=>window.print();
els.saveBtn.onclick = ()=>{ saveProfile(); }; // explicit save (local only)

/* ===== Init ===== */
(function init(){
  profile = loadProfile() || {
    firstName:'', lastName:'', headline:'', trade:'', availability:'Employed',
    location:'', email:'', phone:'', photo:'', summary:'', skills:'', certifications:'', experiences:[]
  };
  renderAll();
})();
</script>
</body>
</html>

