<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sign In • LinkTradeNetwork</title>
<style>
  :root{
    --bg:#0b0f17; --card:#f6f8fb; --ink:#0b1220; --muted:#6b7280; --line:#d8e0ea;
    --btn:#ea6a00; --btn-hover:#c35700; --ok:#22c55e; --err:#ef4444; --link:#3b82f6;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{min-height:100dvh;display:grid;place-items:center;padding:18px}
  .card{
    width:100%;max-width:680px;background:var(--card);
    border:1px solid var(--line);border-radius:14px;box-shadow:0 16px 50px rgba(0,0,0,.35)
  }
  .pad{padding:24px 22px}
  h1{margin:0 0 4px;text-align:center;font-size:32px;line-height:1.1}
  .sub{margin:0 0 16px;text-align:center;color:#8a94a6}
  .notice{display:none;margin:10px 0 6px;padding:10px 12px;border-radius:10px;border:1px solid #a7e3b8;background:#dcfce7;color:#175a2a}
  .row{display:grid;gap:10px}
  .row2{grid-template-columns:1fr 1fr}
  @media (max-width:640px){.row2{grid-template-columns:1fr}}
  label{display:block;font-size:13px;color:#475569;margin:2px 0 4px}
  input,select{
    width:100%;height:46px;border-radius:12px;border:1.5px solid #cfd7e3;background:#fff;color:#0b1220;
    padding:12px 12px;font-size:15px;transition:border .15s,box-shadow .15s
  }
  input::placeholder{color:#9aa7b7}
  input:focus,select:focus{outline:none;border-color:#6b94f7;box-shadow:0 0 0 3px rgba(107,148,247,.25)}
  .agree{display:flex;align-items:center;gap:10px;color:#4b5563;font-size:14px;margin-top:4px}
  .agree input{width:18px;height:18px;accent-color:#3b82f6}
  .btn{
    width:100%;height:52px;margin-top:12px;background:var(--btn);color:#fff;border:0;border-radius:12px;
    font-weight:800;font-size:16px;cursor:pointer;transition:transform .05s,background .15s
  }
  .btn:hover{background:var(--btn-hover)} .btn:active{transform:translateY(1px)} .btn[disabled]{opacity:.6;cursor:not-allowed}
  .msg{margin-top:8px;font-size:14px}.msg.ok{color:var(--ok)}.msg.err{color:var(--err)}
  .foot{margin-top:12px;text-align:center;color:#6b7280;font-size:14px}
  .foot a{color:var(--link);text-decoration:none}.foot a:hover{text-decoration:underline}
  /* OTP */
  .otp{margin-top:14px;padding:14px;border:1px dashed #93a3b8;background:#eef3f9;border-radius:12px;display:none}
  .otp .inputs{display:flex;gap:8px;margin:10px 0;justify-content:center}
  .otp .inputs input{width:54px;height:56px;text-align:center;font-size:22px;border-radius:12px;border:1.5px solid #cbd5e1;background:#fff;color:#0b1220}
  .hide{display:none!important}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="pad">
        <h1>Sign In</h1>
        <p class="sub">Access your LinkTradeNetwork account</p>

        <!-- Welcome banner -->
        <div id="welcomeNotice" class="notice"></div>

        <!-- Step 1: Sign In -->
        <div id="step-join" class="row" style="margin-top:6px">
          <div class="row row2">
            <div>
              <label for="firstName">First Name</label>
              <input id="firstName" type="text" placeholder="First name" autocomplete="given-name">
            </div>
            <div>
              <label for="lastName">Last Name</label>
              <input id="lastName" type="text" placeholder="Last name" autocomplete="family-name">
            </div>
          </div>
          <div>
            <label for="email">Email Address</label>
            <input id="email" type="email" placeholder="you@example.com" autocomplete="email">
          </div>
          <label class="agree">
            <input id="consent" type="checkbox">
            <span>I agree to the <a href="#" target="_blank">Terms &amp; Conditions</a></span>
          </label>
          <button id="joinBtn" class="btn" type="button">Sign In</button>
          <div id="joinMsg" class="msg"></div>
        </div>

        <!-- Step 2: Verify -->
        <div id="step-otp" class="otp">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
            <div>Enter the 6-digit code sent to <b id="otpEmail"></b>. Expires in 10 minutes.</div>
            <button id="resendBtn" class="btn" type="button" style="width:auto;height:42px;padding:0 14px;background:#334155">Resend</button>
          </div>
          <div class="inputs" id="otpInputs">
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*">
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*">
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*">
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*">
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*">
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*">
          </div>
          <button id="verifyBtn" class="btn" type="button">Verify</button>
          <div id="otpMsg" class="msg"></div>
        </div>

        <!-- Step 3: Done -->
        <div id="step-done" class="hide">
          <div class="msg ok"><b>Success!</b> You’re in.</div>
        </div>

        <div class="foot">Don’t have an account? <a href="#" onclick="return false;">Sign Up</a></div>
      </div>
    </div>
  </div>

<script>
(function(){
  // ✅ Live Apps Script endpoint
  const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbw2QDgu99GSd5GbAWSI6WyPPqP8N9doZ4Mbc65xJfb_RIi1_xNnLo-o8MKKUEPgy05V/exec';

  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const joinBtn=$('#joinBtn'), joinMsg=$('#joinMsg');
  const stepJoin=$('#step-join'), stepOtp=$('#step-otp'), stepDone=$('#step-done');
  const otpEmail=$('#otpEmail'), otpMsg=$('#otpMsg');
  const inputs=$$('#otpInputs input'); const welcome=$('#welcomeNotice');
  let currentEmail='', currentName='';

  // OTP input behavior
  inputs.forEach((inp,i)=>{
    inp.addEventListener('input',()=>{inp.value=inp.value.replace(/\D/g,'').slice(0,1); if(inp.value&&i<inputs.length-1)inputs[i+1].focus();});
    inp.addEventListener('keydown',(e)=>{if(e.key==='Backspace'&&!inp.value&&i>0)inputs[i-1].focus();});
  });
  const codeValue=()=>inputs.map(i=>i.value).join('');
  const clearCode=()=>{inputs.forEach(i=>i.value=''); inputs[0].focus();};
  const setMsg=(el,t,c='')=>{el.textContent=t||''; el.className='msg '+c;};

  // Sign In
  joinBtn.addEventListener('click', async ()=>{
    const first=$('#firstName').value.trim();
    const last=$('#lastName').value.trim();
    const email=$('#email').value.trim().toLowerCase();
    const consent=$('#consent').checked;
    if(!first||!email){setMsg(joinMsg,'First name and email are required','err');return;}
    if(!consent){setMsg(joinMsg,'Please agree to the Terms to continue.','err');return;}
    joinBtn.disabled=true; setMsg(joinMsg,'Working…','');

    try{
      const res=await fetch(WEB_APP_URL,{method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({action:'signup',name:first+(last?' '+last:''),email,consent,userAgent:navigator.userAgent})});
      const data=await res.json();
      if(data.success===false){setMsg(joinMsg,data.error||'Error','err');return;}
      if(data.verified && !data.requiresOtp){
        welcome.textContent='Welcome back, '+first+'!'; welcome.style.display='block';
        stepJoin.classList.add('hide'); stepDone.classList.remove('hide'); setMsg(joinMsg,''); return;
      }
      currentEmail=email; currentName=first; otpEmail.textContent=email;
      welcome.style.display='none'; stepJoin.classList.add('hide'); stepOtp.style.display='block'; clearCode(); setMsg(joinMsg,'');

    }catch(err){ setMsg(joinMsg,'Network error.','err'); }
    finally{ joinBtn.disabled=false; }
  });

  // Verify
  $('#verifyBtn').addEventListener('click', async ()=>{
    const code=codeValue(); if(code.length!==6){setMsg(otpMsg,'Enter the 6-digit code.','err');return;}
    try{
      const res=await fetch(WEB_APP_URL,{method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({action:'verify',email:currentEmail,code})});
      const data=await res.json();
      if(!data.success){setMsg(otpMsg,data.error||'Error','err');return;}
      if(data.verified){ stepOtp.style.display='none'; stepDone.classList.remove('hide'); welcome.textContent='Welcome back, '+currentName+'!'; welcome.style.display='block';}
      else{ setMsg(otpMsg,'Unexpected response.','err'); }
    }catch(err){ setMsg(otpMsg,'Network error.','err'); }
  });

  // Resend
  $('#resendBtn').addEventListener('click', async ()=>{
    try{
      const res=await fetch(WEB_APP_URL,{method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({action:'resend',email:currentEmail,name:currentName||'there'})});
      const data=await res.json();
      if(!data.success){setMsg(otpMsg,data.error||'Error','err');return;}
      setMsg(otpMsg,'A new code has been sent.','ok'); clearCode();
    }catch(err){ setMsg(otpMsg,'Network error.','err'); }
  });
})();
</script>
</body>
</html>

