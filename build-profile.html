<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Build Profile ‚Ä¢ LinkTradeNetwork</title>
<style>
  :root{ --bg:#0b0f17; --panel:#101726; --ink:#eaf0ff; --muted:#a9b7d0; --line:#26324b; --brand:#ea6a00; --ok:#22c55e; --err:#ef4444; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  .topbar{display:flex;align-items:center;gap:14px;padding:16px 20px;border-bottom:1px solid var(--line);background:#0f1524;position:sticky;top:0}
  .logo{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);display:inline-grid;place-items:center}
  .brand{font-weight:800}
  .right{display:flex;gap:10px;margin-left:auto}
  .ghost{background:#1f2937;border:1px solid #2a3956;color:#eaf0ff;padding:8px 12px;border-radius:10px;text-decoration:none}
  .wrap{max-width:900px;margin:26px auto;padding:0 16px}
  .card{background:#0f1728;border:1px solid var(--line);border-radius:16px;padding:18px;margin-bottom:16px}
  h1{font-size:22px;margin:0 0 14px}
  label{display:block;color:var(--muted);font-size:13px;margin:10px 0 6px}
  input,textarea{width:100%;background:#0d1422;border:1px solid #2a3956;border-radius:12px;color:var(--ink);padding:12px;font-size:14px}
  textarea{min-height:120px;resize:vertical}
  input:focus,textarea:focus{outline:none;border-color:#3d5278;box-shadow:0 0 0 3px rgba(61,82,120,.25)}
  .grid{display:grid;gap:12px}
  @media(min-width:720px){ .grid.two{grid-template-columns:1fr 1fr} }
  .btnbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
  .btn{background:var(--brand);color:#fff;border:0;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
  .ghostbtn{background:#1f2937;border:1px solid #2a3956;color:#fff;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;text-decoration:none}
  .msg{margin-top:10px;font-size:13px}
  .ok{color:var(--ok)}
  .err{color:var(--err)}
  .avatar{width:64px;height:64px;border-radius:50%;background:#16223a;display:grid;place-items:center;font-weight:800;margin-right:10px}
  .header{display:flex;align-items:center;margin-bottom:8px}
  .header .who{font-size:16px}
</style>
</head>
<body>
  <div class="topbar">
    <div class="logo">üåç</div>
    <div class="brand">LinkTradeNetwork</div>
    <div class="right">
      <a class="ghost" href="/landingpage.html">Home</a>
      <a class="ghost" href="/network.html">Network</a>
      <a class="ghost" href="/messages.html">Messages</a>
      <a class="ghost" href="#" id="logoutBtn">Sign Out</a>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="header">
        <div class="avatar" id="avatar">üë§</div>
        <div class="who">
          <div id="displayName" style="font-weight:800;font-size:18px">Your Name</div>
          <div id="displayEmail" style="color:var(--muted);font-size:13px"></div>
        </div>
      </div>
      <p style="color:var(--muted);margin:6px 0 0">Make it easy for companies to find you. Fill in your headline, location, skills, and about.</p>
    </div>

    <div class="card">
      <h1>Profile details</h1>
      <div class="grid two">
        <div>
          <label>Headline / Job Title</label>
          <input id="headline" placeholder="e.g., Low Voltage Technician ‚Ä¢ Fiber Installer">
        </div>
        <div>
          <label>Company (optional)</label>
          <input id="company" placeholder="e.g., MGMGroup Solution LLC">
        </div>
      </div>

      <div class="grid two">
        <div>
          <label>Location ‚Äî City</label>
          <input id="city" placeholder="e.g., Madison">
        </div>
        <div>
          <label>State / Region</label>
          <input id="region" placeholder="e.g., WI">
        </div>
      </div>

      <div>
        <label>Skills (comma-separated)</label>
        <input id="skills" placeholder="e.g., Fiber splicing, Cat6, Termination, Rack building">
      </div>

      <div>
        <label>About</label>
        <textarea id="about" placeholder="Short summary of your experience, certifications, key projects‚Ä¶"></textarea>
      </div>

      <div class="btnbar">
        <button id="saveBtn" class="btn">Save Profile</button>
        <a href="/landingpage.html" class="ghostbtn">Cancel</a>
      </div>
      <div id="formMsg" class="msg"></div>
    </div>
  </div>

<script src="/script.js"></script>
<script>
  // Require sign-in
  requireUserOrRedirect();
  const user = getUser();
  const email = (user && user.email) || '';
  const name = (user && user.name) || '';

  // UI header
  document.getElementById('displayName').textContent = name || 'Your Name';
  document.getElementById('displayEmail').textContent = email;
  document.getElementById('avatar').textContent = initials(name);

  // Local profile key
  const PK = 'ltn_profile_' + (email || 'anon');

  // Load saved (local) profile immediately for good UX
  const local = loadLocalProfile();
  if (local) fillForm(local);

  // Try to fetch from backend (if action exists there). If it fails, we keep local.
  fetchServerProfile().catch(()=>{/* ignore for now */});

  // Save
  document.getElementById('saveBtn').addEventListener('click', async ()=>{
    const p = readForm();
    // Save locally (always)
    localStorage.setItem(PK, JSON.stringify(p));
    setMsg('Saving‚Ä¶');
    try{
      // Try backend save (will succeed once backend supports action 'save_profile')
      await postJSON({ action:'save_profile', email, profile: p });
      setMsg('Profile saved ‚úî and synced to server.', 'ok');
    }catch(e){
      setMsg('Profile saved ‚úî locally. (Server sync pending backend update.)', 'ok');
    }
  });

  // Sign out
  document.getElementById('logoutBtn').addEventListener('click', (e)=>{ e.preventDefault(); signOut(); });

  // Helpers
  function initials(n){
    if(!n) return 'üë§';
    const parts = n.trim().split(/\s+/).slice(0,2);
    return parts.map(s=>s[0]?.toUpperCase()||'').join('') || 'üë§';
  }
  function setMsg(t, cls=''){
    const el = document.getElementById('formMsg');
    el.textContent = t || '';
    el.className = 'msg ' + (cls || '');
  }
  function readForm(){
    return {
      name,
      email,
      headline: document.getElementById('headline').value.trim(),
      company:  document.getElementById('company').value.trim(),
      city:     document.getElementById('city').value.trim(),
      region:   document.getElementById('region').value.trim(),
      skills:   document.getElementById('skills').value.trim(),
      about:    document.getElementById('about').value.trim(),
      updatedAt: new Date().toISOString()
    };
  }
  function fillForm(p){
    document.getElementById('headline').value = p.headline || '';
    document.getElementById('company').value  = p.company  || '';
    document.getElementById('city').value     = p.city     || '';
    document.getElementById('region').value   = p.region   || '';
    document.getElementById('skills').value   = p.skills   || '';
    document.getElementById('about').value    = p.about    || '';
  }
  function loadLocalProfile(){
    try{ return JSON.parse(localStorage.getItem(PK) || 'null'); } catch { return null; }
  }
  async function fetchServerProfile(){
    try{
      const r = await postJSON({ action:'get_profile', email });
      if (r && r.success && r.profile){
        // merge server profile into local and UI
        localStorage.setItem(PK, JSON.stringify(r.profile));
        fillForm(r.profile);
      }
    }catch(e){ /* backend not ready yet ‚Äî ignore */ }
  }
</script>
</body>
</html>




         




