<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Build Your Profile - LinkTradeNetwork</title>
<style>
  :root{--bg:#f3f4f6;--card:#fff;--ink:#111827;--muted:#6b7280;--line:#e5e7eb;--brand:#3b82f6;--brand2:#2563eb}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;color:var(--ink)}
  header{background:#64748b;color:#fff;padding:1rem 1.25rem}
  .wrap{max-width:900px;margin:1.25rem auto;padding:0 1rem}
  .card{background:var(--card);border-radius:12px;box-shadow:0 1px 3px rgba(0,0,0,.1);padding:1.25rem}
  h1{font-size:1.6rem;margin:.25rem 0 1rem}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .full{grid-column:1 / -1}
  label{display:block;font-weight:600;margin:.25rem 0 .35rem}
  input,select,textarea{width:100%;padding:.7rem .8rem;border:1.5px solid var(--line);border-radius:8px;background:#fff;font-size:1rem}
  textarea{min-height:110px;resize:vertical}
  small{color:var(--muted)}
  .row{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:1rem}
  .btn{background:var(--brand);color:#fff;border:none;padding:.7rem 1rem;border-radius:8px;font-weight:700;cursor:pointer}
  .btn:hover{background:var(--brand2)}
  .btn-gray{background:#6b7280}.btn-gray:hover{background:#4b5563}
  .hint{background:#fef3c7;border:1px solid #f59e0b;color:#92400e;border-radius:8px;padding:.75rem 1rem;margin:0 0 1rem}
  .photo{display:flex;align-items:center;gap:12px}
  .photo-preview{width:64px;height:64px;border-radius:50%;background:#eef2ff;display:flex;align-items:center;justify-content:center;overflow:hidden;border:3px solid #fff;box-shadow:0 0 0 2px #dbeafe}
  .photo-preview img{width:100%;height:100%;object-fit:cover}
  #message{margin:.75rem 0;padding:.6rem .8rem;border-radius:8px;display:none}
  #message.ok{display:block;background:#d1fae5;border:1px solid #10b981;color:#065f46}
  #message.err{display:block;background:#fee2e2;border:1px solid #ef4444;color:#991b1b}
  @media (max-width:720px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
      <a href="front.html" style="color:#000;text-decoration:none;display:flex;align-items:center;gap:8px;background:#d1d5db;padding:.4rem .6rem;border-radius:8px">üåç LinkTradeNetwork</a>
      <a href="profile.html" class="btn btn-gray" style="text-decoration:none">View My Profile</a>
    </div>
  </header>

  <div class="wrap">
    <div class="hint">Start fresh: fields are blank on purpose. Only First Name, Last Name, and Trade are required.</div>

    <div id="message"></div>

    <!-- Form is blocked from default submit to avoid unwanted navigation -->
    <form id="profileForm" onsubmit="return false;">
      <div class="card">
        <h1>Build Your Profile</h1>
        <div class="grid">
          <div>
            <label for="firstName">First Name *</label>
            <input id="firstName" autocomplete="off" />
          </div>
          <div>
            <label for="lastName">Last Name *</label>
            <input id="lastName" autocomplete="off" />
          </div>

          <div class="full">
            <label for="headline">Headline</label>
            <input id="headline" autocomplete="off" />
          </div>

          <div>
            <label for="trade">Trade / Role *</label>
            <input id="trade" autocomplete="off" />
          </div>
          <div>
            <label for="availability">Availability</label>
            <select id="availability">
              <option>Employed</option>
              <option>Actively Looking</option>
              <option>Open to Offers</option>
              <option>Not Available</option>
            </select>
          </div>

          <div>
            <label for="location">Location</label>
            <input id="location" autocomplete="off" />
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" autocomplete="off" />
          </div>

          <div>
            <label for="phone">Phone</label>
            <input id="phone" autocomplete="off" />
          </div>
          <div class="photo">
            <div>
              <label for="photo">Photo (optional)</label>
              <input id="photo" type="file" accept="image/*" />
              <small>Square works best</small>
            </div>
            <div class="photo-preview" id="preview">üë§</div>
          </div>

          <div class="full">
            <label for="summary">About</label>
            <textarea id="summary"></textarea>
          </div>

          <div class="full">
            <label for="skills">Skills (comma-separated)</label>
            <input id="skills" autocomplete="off" />
          </div>

          <div class="full">
            <label for="certs">Certifications & Licenses</label>
            <textarea id="certs"></textarea>
          </div>

          <!-- Experience -->
          <div class="full"><label>Experience (one recent role)</label></div>
          <div><input id="jobTitle" placeholder="Job Title"/></div>
          <div><input id="company"  placeholder="Company"/></div>
          <div><input id="startDate" placeholder="Start e.g., 2023-01"/></div>
          <div><input id="endDate"   placeholder="End e.g., Present"/></div>
          <div class="full"><textarea id="jobDesc" placeholder="What you did in this role..."></textarea></div>
        </div>

        <div class="row">
          <button class="btn" id="saveBtn" type="button">Save</button>
          <button class="btn btn-gray" id="clearBtn" type="button" title="Clear everything">Clear</button>
          <a class="btn btn-gray" href="profile.html" id="viewBtn">View My Profile</a>
        </div>
      </div>
    </form>
  </div>

<script>
  // === CONFIG ===
  const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwvpweco_FFHNvx-XT4JDvULZ0ax9fVG34gJGbk_3zZz6mUYuvUwJo8ayR0ysqrIDyw/exec';
  const STORAGE_KEY = 'userProfile:v1';
  const LEGACY_KEY  = 'userProfile';
  const REDIRECT_CANDIDATES = ['profile.html','my-profile.html','front.html'];

  // === ELEMENTS ===
  const els = {
    form:       document.getElementById('profileForm'),
    firstName:  document.getElementById('firstName'),
    lastName:   document.getElementById('lastName'),
    headline:   document.getElementById('headline'),
    trade:      document.getElementById('trade'),
    availability: document.getElementById('availability'),
    location:   document.getElementById('location'),
    email:      document.getElementById('email'),
    phone:      document.getElementById('phone'),
    photo:      document.getElementById('photo'),
    preview:    document.getElementById('preview'),
    summary:    document.getElementById('summary'),
    skills:     document.getElementById('skills'),
    certs:      document.getElementById('certs'),
    jobTitle:   document.getElementById('jobTitle'),
    company:    document.getElementById('company'),
    startDate:  document.getElementById('startDate'),
    endDate:    document.getElementById('endDate'),
    jobDesc:    document.getElementById('jobDesc'),
    msg:        document.getElementById('message'),
    saveBtn:    document.getElementById('saveBtn'),
    clearBtn:   document.getElementById('clearBtn'),
  };

  // Keep form from submitting (and navigating)
  els.form.addEventListener('submit', (e)=>{ e.preventDefault(); return false; });

  // ===== Helpers =====
  function showMsg(text, ok=true){
    els.msg.className = ok ? 'ok' : 'err';
    els.msg.textContent = text;
    els.msg.style.display = 'block';
  }
  function setVal(el, v=''){ el.value = v; }
  function escapeHTML(s){ return String(s ?? '')
    .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

  // Photo handling (still blank by default)
  let currentPhotoDataUrl = '';
  els.photo.addEventListener('change', async (e)=>{
    const f = e.target.files?.[0];
    if(!f) return;
    const dataUrl = await fileToDataURL(f);
    currentPhotoDataUrl = dataUrl;
    els.preview.innerHTML = `<img src="${dataUrl}" alt="Preview">`;
  });
  function fileToDataURL(file){
    return new Promise((res, rej)=>{
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = rej;
      r.readAsDataURL(file);
    });
  }

  // IMPORTANT: Do NOT preload from localStorage ‚Äî always blank.
  // (If you ever need to opt-in prefill later, we can add a button for that.)

  // Clear all fields quickly
  function clearAll(){
    setVal(els.firstName); setVal(els.lastName); setVal(els.headline);
    setVal(els.trade); els.availability.value = 'Employed';
    setVal(els.location); setVal(els.email); setVal(els.phone);
    currentPhotoDataUrl=''; els.preview.textContent='üë§'; els.photo.value='';
    setVal(els.summary); setVal(els.skills); setVal(els.certs);
    setVal(els.jobTitle); setVal(els.company); setVal(els.startDate); setVal(els.endDate); setVal(els.jobDesc);
    showMsg('Fields cleared.', true);
  }
  els.clearBtn.addEventListener('click', clearAll);

  // Smart redirect after save
  async function smartRedirect(){
    for(const file of REDIRECT_CANDIDATES){
      try{
        const res = await fetch(file, {method:'HEAD'});
        if(res.ok){ window.location.href = file; return; }
      }catch(_){}
    }
    window.location.href = REDIRECT_CANDIDATES[0];
  }

  // Save handler (blank start, but will store what you enter)
  els.saveBtn.addEventListener('click', async ()=>{
    const firstName = els.firstName.value.trim();
    const lastName  = els.lastName.value.trim();
    const trade     = els.trade.value.trim();
    if(!firstName || !lastName || !trade){
      showMsg('Please fill First Name, Last Name, and Trade (required).', false);
      return;
    }

    const profile = {
      firstName, lastName,
      headline: els.headline.value.trim(),
      trade,
      availability: els.availability.value,
      location: els.location.value.trim(),
      email: els.email.value.trim(),
      phone: els.phone.value.trim(),
      photo: currentPhotoDataUrl || '',
      summary: els.summary.value.trim(),
      skills: els.skills.value.trim(),
      certifications: els.certs.value.trim(),
      experiences: [{
        jobTitle: els.jobTitle.value.trim(),
        company:  els.company.value.trim(),
        startDate: els.startDate.value.trim(),
        endDate:   els.endDate.value.trim(),
        description: els.jobDesc.value.trim()
      }],
      createdAt: new Date().toISOString()
    };

    els.saveBtn.disabled = true;
    els.saveBtn.textContent = 'Saving‚Ä¶';

    try{
      // Send to Google Sheets
      await fetch(GOOGLE_SCRIPT_URL, {
        method:'POST', mode:'no-cors',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(profile)
      });

      // Save locally for the viewer page
      const raw = JSON.stringify(profile);
      localStorage.setItem(STORAGE_KEY, raw);
      localStorage.setItem(LEGACY_KEY, raw);

      showMsg('‚úÖ Profile saved! Opening your profile‚Ä¶', true);
      setTimeout(()=>{ smartRedirect(); }, 600);
    }catch(err){
      console.error(err);
      showMsg('‚ùå Save failed. Check your internet or Google Script URL.', false);
      els.saveBtn.disabled = false;
      els.saveBtn.textContent = 'Save';
    }
  });

  // Safety: prevent Backspace from navigating away when not in a field
  window.addEventListener('keydown', (e)=>{
    if(e.key==='Backspace' && !['INPUT','TEXTAREA'].includes(document.activeElement.tagName)){
      e.preventDefault();
    }
  });
</script>
</body>
</html>




